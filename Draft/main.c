#include <msp430.h>
#define uchar unsigned char
#define uint  unsigned int
//定义Max7219端口
#define Max7219_pinCLK1 P1OUT |= BIT3
#define Max7219_pinCLK0 P1OUT &=~ BIT3
#define Max7219_pinDIN1 P1OUT |= BIT2
#define Max7219_pinDIN0 P1OUT &=~ BIT2
#define Max7219_pinCS1  P1OUT |= BIT5
#define Max7219_pinCS0  P1OUT &=~ BIT5

uchar disp1[24][8]={
        {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
        {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x38},
        {0x00,0x00,0x00,0x00,0x00,0x00,0x38,0x28},
        {0x00,0x00,0x00,0x00,0x00,0x38,0x28,0xFF},
        {0x00,0x00,0x00,0x00,0x38,0x28,0xFF,0x28},
        {0x00,0x00,0x00,0x38,0x28,0xFF,0x28,0x38},
        {0x00,0x00,0x38,0x28,0xFF,0x28,0x38,0x00},
        {0x00,0x38,0x28,0xFF,0x28,0x38,0x00,0x00},//
        {0x38,0x28,0xFF,0x28,0x38,0x00,0x00,0xFF},
        {0x28,0xFF,0x28,0x38,0x00,0x00,0xFF,0x81},
        {0xFF,0x28,0x38,0x00,0x00,0xFF,0x81,0xCB},
        {0x28,0x38,0x00,0x00,0xFF,0x81,0xCB,0xFF},
        {0x38,0x00,0x00,0xFF,0x81,0xCB,0xFF,0xEB},
        {0x00,0x00,0xFF,0x81,0xCB,0xFF,0xEB,0xCB},
        {0x00,0xFF,0x81,0xCB,0xFF,0xEB,0xCB,0x81},
        {0xFF,0x81,0xCB,0xFF,0xEB,0xCB,0x81,0xFF},
        {0x81,0xCB,0xFF,0xEB,0xCB,0x81,0xFF,0x00},
        {0xCB,0xFF,0xEB,0xCB,0x81,0xFF,0x00,0x00},
        {0xFF,0xEB,0xCB,0x81,0xFF,0x00,0x00,0x00},
        {0xEB,0xCB,0x81,0xFF,0x00,0x00,0x00,0x00},
        {0xCB,0x81,0xFF,0x00,0x00,0x00,0x00,0x00},
        {0x81,0xFF,0x00,0x00,0x00,0x00,0x00,0x00},
        {0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
        {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}
};
void Write_Max7219_byte(uchar DATA)
{
    uchar i,temp;
    for (i=0;i<8;i++)
    {
        temp=DATA&0x80;
        DATA=DATA<<1;
        if(temp)
        {
            Max7219_pinDIN1;
        }
        else
        {
            Max7219_pinDIN0;
        }
        Max7219_pinCLK0;
        Max7219_pinCLK1;
    }
}
//-------------------------------------------
//功能：向MAX7219写入数据
//入口参数：address、dat
//出口参数：无
//说明：
void Write_Max7219(uchar address,uchar dat)
{
    Max7219_pinCS0;
    Write_Max7219_byte(address);           //写入地址，即数码管编号
    Write_Max7219_byte(dat);               //写入数据，即数码管显示数字
    Max7219_pinCS1;
}

void Init_MAX7219(void)
{
    P1SEL&=~(BIT2+BIT5+BIT3);
    P1DIR |=BIT2+BIT5+BIT3;

    Write_Max7219(0x09, 0x00);       //译码方式：BCD码
    Write_Max7219(0x0a, 0x03);       //亮度
    Write_Max7219(0x0b, 0x07);       //扫描界限；8个数码管显示
    Write_Max7219(0x0c, 0x01);       //掉电模式：0，普通模式：1
    Write_Max7219(0x0f, 0x00);       //显示测试：1；测试结束，正常显示：0
}

void main(void)
{
    WDTCTL=WDTPW+WDTHOLD;
    Init_MAX7219();
    int i,j;
    while(1)
    {
        for(j=0;j<24;j++)
        {
            for(i=1;i<9;i++)
            {
                Write_Max7219(i,disp1[j][i-1]);
            }
            _delay_cycles(100000);
        }
    }
}
